### Setup

```{r}
## --- Packages ------------------------------------ ##
library(multitaper)
library(pbapply)
library(kableExtra)
library(itsmr)
library(animation)
library(fields)

## --- Splot + Spalette ---------------------------- ##
load(file = "C:/Users/skyep/Documents/Research/PhD_Proposal/Data/splot.RData")
```




# Spectrograms

## Noise \& AR(2)

```{r setupSgram_zy}

## --- Load 
load(file = "C:/Users/skyep/Documents/Research/PhD_Proposal/Data/noise_B200_mini.RData")
bc.z  <- bc
cbc.z <- cbc

load(file = "C:/Users/skyep/Documents/Research/PhD_Proposal/Data/AR2_B200_mini.RData")
bc.y  <- bc
cbc.y <- cbc

## --- Scaling & plot limits
bc.y$mean  <- bc.y$mean *100 # scale
cbc.y$mean <- cbc.y$mean*100

zlim.z <- range(ztf.true, bc.z$mean, cbc.z$mean)
zlim.y <- range(ytf.true, bc.y$mean, cbc.y$mean)
```

```{r Sgram_xy}

png(filename = paste0("C:/Users/skyep/Documents/Research/PhD_Proposal/Plots/sgrams_Noise-AR2_B",B,".png"),
    width = 8.5, height = 11, units = "in", res = 200, bg = skol$salt, pointsize = 8)
## ----------------------------------------------------------------------------------

      ## --- MARGINS
      par(mfrow = c(3,2), oma = c(4,1,4,3), mar = c(7,5,2,2))


  ## --- TRUE Z 
  image(x = Fs, y = t, z = t(ztf.true),
        xlab = "", ylab = "", zlim = zlim.z,
        las = 1, col = tim.colors()); sox()
  slab("True Time-Frequency Spectrum: White Noise z(t)",
       "","","Time")
  
  ## --- TRUE Y
  image(x = Fs, y = t, z = t(ytf.true),
        xlab = "", ylab = "", zlim = zlim.y,
        las = 1, col = tim.colors()); sox()
  slab("True Time-Frequency Spectrum: AR(2) series y(t)",
       "","","")


      ## --- BC Z
      image(x = Fs, y = t, z = t(bc.z$mean),
            xlab = "", ylab = "", zlim = zlim.z,
            las = 1, col = tim.colors()); sox()
      slab("BCMTFSE:  White Noise x(t)",
           "","","Time")
      
      ## --- BC Y
      image(x = Fs, y = t, z = t(bc.y$mean),
            xlab = "", ylab = "", zlim = zlim.y,
            las = 1, col = tim.colors()); sox()
      slab("BCMTFSE:  AR(2) series y(t)",
           "","","")


  ## --- CBC Z
  image(x = Fs, y = t, z = t(cbc.z$mean),
        xlab = "", ylab = "", zlim = zlim.z,
        las = 1, col = tim.colors()); sox()
  slab("CBCMTFSE:  White Noise x(t)",
       "","Frequency","Time")
  image.plot(legend.only = TRUE,
             zlim = zlim.z,
             horizontal = TRUE, smallplot = c(0.11,0.96,0,0.05))
  
  ## --- CBC Y
  image(x = Fs, y = t, z = t(cbc.y$mean),
        xlab = "", ylab = "", zlim = zlim.y,
        las = 1, col = tim.colors()); sox()
  slab("CBCMTFSE:  AR(2) series y(t)",
       "","Frequency","")
  image.plot(legend.only = TRUE,
             zlim = zlim.y,
             horizontal = TRUE, smallplot = c(0.11,0.96,0,0.05))

## ----------------------------------------------------------------------------------
dev.off()

```



## UMP

```{r setupSgram_z}

## --- Load 
load(file = "C:/Users/skyep/Documents/Research/PhD_Proposal/Data/UMP_B200_mini.RData")
bc.x  <- bc
cbc.x <- cbc

## --- Scaling & plot limits
zlim.z <- range(xtf.true, bc.x$mean, cbc.x$mean)
```

```{r Sgram_z}

png(filename = paste0("C:/Users/skyep/Documents/Research/PhD_Proposal/Plots/sgrams_UMP_B",B,".png"),
    width = 12.6, height = 4.2, units = "in", res = 200, bg = skol$salt, pointsize = 8)
## ----------------------------------------------------------------------------------

  # Margins
  par(mfrow = c(1,3), oma = c(0,3,0,5))
  
  # --- TRUE
  image(x = Fs, y = t, z = t(xtf.true/1e4),
        xlab = "", ylab = "", zlim = zlim.x,
        las = 1, col = tim.colors()); sox()
  slab("True TFS: UMP x(t)",
       "","Frequency","Time"); gc()
  
  # --- BC
  image(x = Fs, y = t, z = t(bc.x$mean),
        xlab = "", ylab = "", zlim = zlim.x,
        las = 1, col = tim.colors()); sox()
  slab("BCMTFSE:  UMP x(t)",
       "","Frequency",""); gc()
  
  # --- CBC
  image(x = Fs, y = t, z = t(cbc.x$mean),
        xlab = "", ylab = "", zlim = zlim.x,
        las = 1, col = tim.colors()); sox()
  slab("CBCMTFSE:  UMP x(t)",
       "","Frequency",""); gc()
  
  # --- Legend
  par(oma = c(0,0,0,3))
  image.plot(legend.only = TRUE,
             zlim = zlim.x, legend.shrink = 1, legend.width = 2)

## ----------------------------------------------------------------------------------
dev.off()
  
```






# Animations

## Frequency-Domain Animations

```{r}
## --- Choose your series
load("C:/Users/skyep/Documents/Research/PhD_Proposal/Data/")
```

```{r ani_prep}
## --- Plot Prep ---------------- ###

# Confidence Intervals (if it were Gaussian... isn't it more chi^2?)
bc.low   <-  bc$mean - 2* bc$se
bc.high  <-  bc$mean + 2* bc$se
cbc.low  <- cbc$mean - 2*cbc$se
cbc.high <- cbc$mean + 2*cbc$se

# ylims
ylim <- range(bc.low, cbc.low, bc.high, cbc.high)

# Spectrogram limit
zlim <- range(xtf.true/1e4, bc$mean, cbc$mean)
```

```{r f_domain_gif}

p <- 0
pb <- txtProgressBar(style = 3)

### --- Create GIF ------------------- ###

saveGIF({  for (my.t in seq(1,N,by = 5)) {
  
  # --- True Plot
  splot(Fs, ztf.true[my.t,]/1e4, type = "l", ylim = ylim.tx, lwd = 2, colr = "#FCF8F8"); gc()
  
  # --- Means
  lines(Fs,  bc$mean[my.t,], col = "dodgerblue2", lwd = 2) # OLD bc
  lines(Fs, cbc$mean[my.t,], col = "goldenrod"  , lwd = 2) # Cbc  
  
  # --- Standard Errors
  lines(Fs, bc.low [my.t,] , col = skol$blue  , lwd = 1)                     
  lines(Fs, bc.high[my.t,] , col = skol$blue  , lwd = 1)                     
  
  lines(Fs, cbc.low [my.t,], col = skol$orange, lwd = 1)                     
  lines(Fs, cbc.high[my.t,], col = skol$orange, lwd = 1)                     
  
  # --- Labels
  slab(main = "Spectrogram Estimates: UMP: c(t)*AR(2)",
       subb = bquote("c(t) = exp{ (-t-500)"^2*"/(2(200"^2*")) }        Blockwidth B ="~.(B)),
       xlab = "Frequency",
       ylab = bquote(hat(S)[X]~"(t = "*.(my.t)*", f)")); gc()
  
  
  ## --- Legends (& other graphics) --------------------------- ##
  legend("topright",
         legend = c("means","mean +/- 2se","",
                    "True spectrum at t",
                    "BCMTFSE",
                    "CBCMTFSE"),
         lty = c( 1, 1,NA,    1,NA,NA),
         lwd = c( 3, 1,NA,   NA,NA,NA),
         pch = c(NA,NA,NA,   19,19,19),
         
         col = c(skol$brown4, skol$brown4, skol$brown4,     skol$brown4,"dodgerblue2","goldenrod"),
         bg  = "white",
         inset = c(0.01,0.02)
    )
  legend("topleft", legend = bquote("Time t ="*.(my.t)*"  "),
         inset = c(0.05,0.08), cex = 2.5,
         bg = if((my.t >= tb[1]) & (my.t <= max(tb))) {skol$green} else {"#F4A4A8"})
  ## ---------------------------------------------------------- ##  
  
  gc()
    p <- p+1
    setTxtProgressBar(pb, p/500)

    } },
  
  # --- GIF details
  interval   = 0.1,
  movie.name = paste0("~/Plots/",my.type,"_B",B,".gif"),
  ani.height = 668, ani.width = 1080); gc()
```























































