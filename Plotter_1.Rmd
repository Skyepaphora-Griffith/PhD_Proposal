### Setup

```{r}
## --- Packages ------------------------------------ ##
library(multitaper)
library(pbapply)
library(kableExtra)
library(itsmr)
library(animation)
library(fields, quietly = TRUE, warn.conflicts = FALSE)
```

```{r}
## --- Splot + Spalette ---------------------------- ##
load("C:/Users/skyep/Documents/Research/Skyes_Toolbox/splot.RData")
```




# Spectrograms

## PBCs : 1 x 3 lattice

```{r reset_tru}
# tru1 <- list(yf = tru$yf, ytf = tru$ytf, xtf = tru$xtf)
# all(tru$yf == tru1$yf);all(tru$ytf == tru1$ytf);all(tru$xtf == tru1$xtf)
# tru <- tru1; rm(tru1)
```

```{r setup_pbcGram}
## --- Load 
# load(file = "Data/AR2_B200___mini.RData")
load(file = "Data/UMP_c1_B100___mini.RData")
# load(file = "Data/UMP_c1_B200___mini.RData")
# load(file = "Data/UMP_c1_B300___mini.RData")
# load(file = "Data/UMP_c3_B200___mini.RData")
# load(file = "Data/UMP_c3_B300___mini.RData")
# load(file = "Data/UMP_c3_B400___mini.RData")
# load(file = "Data/other_B100___mini.RData")
# load(file = "Data/other_B200___mini.RData")

## --- sgram legend placement
leggo <- list(single = c(0.925 ,0.95 ,0.1 ,0.925),
              double.h = c(0.9 ,0.94 ,0.1 ,0.925),
              triple.h = c(0.85 ,0.9 ,0.15,0.875))

## --- Normalizing function
kable(data.frame(range(tru$xtf),range(pbc$bc1$mean),range(pbc$bc2$mean)), format = "pipe")

normy <- function(x){x/max(abs(x))} # generic 0-1
normy <- function(x){x*1e2*(x>=0)}  # AR, UMP
# normy <- function(x){x*(x>=0)}      # other (non-stationary AR)

## --- Common z-axis limits
# zlim <- 0:1 
zlim <- c(0,max(normy(pbc$bc1$mean),normy(pbc$bc2$mean),tru$xtf)) # 
zlim <- c(range(normy(pbc$bc1$mean),normy(pbc$bc2$mean),tru$xtf)) #; zlim <- c(0,max(tru$xtf))

tix <- round(seq(0,zlim[2],length.out=7))         # legend ticks [0,max]
tix <- round(seq(zlim[1],zlim[2],length.out=7))   # legend ticks [range]

```

```{r pbcGram_GO}
# # --- Prep 3 
wid <- 8
png(filename = paste0("FinalPlots/PBCs___",my.type,
                      if(my.type=="UMP"){paste0("_",cc)}else{NULL},
                      "_B",B,".png"),
width = wid, height = wid/3, units = "in", res = 400, pointsize = 9)
par(mfrow = c(1,3), mar = c(4,0,3.5,1), oma = c(0,4,0,5.6))
# ---------------------------------------------------------------------------------

  ## --- TRUE
  image(x = Fs, y = t, z = t((tru$xtf)),
        xlab = "", ylab = "", zlim = zlim,
        las = 1, col = tim.colors()); sox()
  abline(h = range(tb), col = skrown$salt, lty = 2)
  slab(
       # "Example A   [AR(2)]",
       "Example B   [UMP]",
       # "Example C   [UMP]",
       # "Example D [Non-Stationary]",
       bquote("True"~"Time-Frequency Spectrum"),"Frequency","Time", yline = 2.5, mline = 2, cex.factor = 0.9)

  ## --- 1-BC
  image(x = Fs, y = t, z = t(normy(pbc$bc1$mean)),
        xlab = "", ylab = "", zlim = zlim,
        las = 1, yaxt = 'n', col = tim.colors()); sox()
  abline(h = range(tb), col = skrown$salt, lty = 2)
  slab(
       # "1-BC: Example A",
       "1-BC: Example B",
       # "1-BC: Example C",
       # "1-BC: Example D",
       bquote("Average over M ="~.(M)~"simulations;"~bold("B =")~bold(.(as.character(B))) ),
       "Frequency","", mline = 2, cex.factor = 0.9)

  ## --- 2-BC
  image(x = Fs, y = t, z = t(normy(pbc$bc2$mean)),
        xlab = "", ylab = "", zlim = zlim,
        las = 1, yaxt = 'n', col = tim.colors()); sox()
  abline(h = range(tb), col = skrown$salt, lty = 2)
  slab(
       # "2-BC: Example A",
       "2-BC: Example B",
       # "2-BC: Example C",
       # "2-BC: Example D",
       bquote("Average over M ="~.(M)~"simulations;"~bold("B =")~bold(.(as.character(B))) ),
       "Frequency","", mline = 2, cex.factor = 0.9)
  
  ## --- Legend
  par(oma = c(0,0,0,0))
  image.plot(legend.only = TRUE, legend.lab = "Power", zlim = zlim,
             # legend.line = 0.5, legend.cex = 1.2, # Single
             # legend.line = 1, legend.cex = 1.1, # Double H
             legend.line = -3, legend.cex = 1, # Triple H
             smallplot   = leggo$triple.h,
             axis.args = list(at = tix, labels = tix))
  
# ---------------------------------------------------------------------------------
dev.off()
```


## Smoothed PBCs : 3 x 1 lattice

```{r setup_smooGram}
## --- Load 
# load(file = "Data/UMP_c1_B200___reduced_S-2bc.RData")
load(file = "Data/UMP_c1_B300___reduced_S-2bc.RData"); gc()
# load(file = "Data/UMP_c3_B200___reduced_S-2bc.RData")
# load(file = "Data/UMP_c3_B300___reduced_S-2bc.RData"); gc()

## --- sgram legend placement
leggo <- c(0.85 ,0.9 ,0.15,0.875)

## --- Normalizing function
normy <- function(x){x/max(abs(x))} # generic 0-1
normy <- function(x){x*1e2*(x>=0)}  # AR, UMP
normy <- function(x){x*(x>=0)}      # other (non-stationary AR)
normy <- function(x){abs(x/max(abs(x)))}

## --- Common z-axis limits
# zlim <- 0:1 
zlim <- c(0,max(normy(bc2.samp),normy(bc2.smooth),normy(ssx))) # 
zlim <- c(range(normy(bc2.samp),normy(bc2.smooth),normy(ssx))) #

tix <- round(seq(0,zlim[2],length.out=7))         # legend ticks [0,max]
tix <- round(seq(zlim[1],zlim[2],length.out=7))   # legend ticks [range]

# --- Check limits
kable(data.frame(range(bc2.samp),range(bc2.smooth),range(ssx)), format = "pipe")
```

```{r smooGram_GO}
# # --- Prep 3 
wid <- 8
png(filename = paste0("FinalPlots/Sx___",my.type,
                      if(my.type=="UMP"){paste0("_",cc)}else{NULL},
                      "_B",B,
                      "___smooth-3.png"),
width = wid, height = wid/3, units = "in", res = 400, pointsize = 9)
par(mfrow = c(1,3), mar = c(4,0,3.5,1), oma = c(0,4,0,5.6))
# ---------------------------------------------------------------------------------

  ## --- raw 2-BC
  image(x = Fs, y = t, z = t(normy(bc2.samp)),
        xlab = "", ylab = "", zlim = zlim,
        las = 1, yaxt = 'n', col = tim.colors()); sox()
  abline(h = range(tb), col = skrown$salt, lty = 2)
  slab(
       "Unsmoothed 2-BC: Example B",
       # "Smoothed 2-BC: Example C",
       bquote("Single simulation;"~bold("B =")~bold(.(as.character(B))) ),
       "Frequency","", mline = 2, cex.factor = 0.9)
  
    ## --- smooth 2-BC
  image(x = Fs, y = t, z = (normy(bc2.smooth)),
        xlab = "", ylab = "", zlim = zlim,
        las = 1, yaxt = 'n', col = tim.colors()); sox()
  abline(h = range(tb), col = skrown$salt, lty = 2)
  slab(
       "Smoothed 2-BC: Example B",
       # "Smoothed 2-BC: Example C",
       bquote("Single simulation;"~bold("B =")~bold(.(as.character(B))) ),
       "Frequency","", mline = 2, cex.factor = 0.9)
  
  ## --- mean smooth 2-BC
  image(x = Fs, y = t, z = t(normy(ssx)),
        xlab = "", ylab = "", zlim = zlim,
        las = 1, yaxt = 'n', col = tim.colors()); sox()
  abline(h = range(tb), col = skrown$salt, lty = 2)
  slab(
       "Smoothed 2-BC: Example B",
       # "Smoothed 2-BC: Example C",
       bquote("Average over M ="~.(M)~"simulations;"~bold("B =")~bold(.(as.character(B))) ),
       "Frequency","", mline = 2, cex.factor = 0.9)


  ## --- Legend
  par(oma = c(0,0,0,0))
  image.plot(legend.only = TRUE, legend.lab = "Power", zlim = zlim,
             legend.line = -3, legend.cex = 1,
             smallplot   = leggo,
             axis.args = list(at = tix, labels = tix))
  
# ---------------------------------------------------------------------------------
dev.off()
```

# GEST \& YEST

## 2 x 1 lattice

```{r setup_gyf}
## --- Load 
load("Data/UMP_c1_B200___S-2bc.RData"); load("Data/UMP_c1_B200___mini.RData"); gc()
# load("Data/UMP_c1_B300___S-2bc.RData"); load("Data/UMP_c1_B300___mini.RData"); gc()
# load("Data/UMP_c3_B200___S-2bc.RData"); load("Data/UMP_c3_B200___mini.RData"); gc()
# load("Data/UMP_c3_B300___S-2bc.RData"); load("Data/UMP_c3_B300___mini.RData"); gc()

## --- BC Type
poly <- 1
# poly <- 2

if(poly == 1){
  ag <- ag.1; ayf <- ayf.1
  sg <- sg.1; syf <- syf.1
}else{
  ag <- ag.2; ayf <- ayf.2
  sg <- sg.2; syf <- syf.2
}

## --- Normalizing function
normy <- function(x){abs(x/max(abs(x)))}

## --- Common limits
glim <- range(gt,  -sg, -ag )
flim <- range(normy(tru$yf), syf, ayf)

# --- Check limits
kable(data.frame(range(gt),range(sg),range(ag),range(normy(tru$yf)),range(syf),range(ayf)), format = "pipe")
```

```{r}
# --- Prep 2
wid <- 8
png(filename = paste0("FinalPlots/TEST---G-YF___",
                      my.type,
                      if(my.type=="UMP"){paste0("_",cc)}else{NULL},
                      "_B",B,
                      "___",poly,"-BC.png"),
width = wid, height = wid/2.25, units = "in", res = 400, pointsize = 9)
par(mfrow = c(1,2), mar = c(4,3.75,3.5,0.5))
# ---------------------------------------------------------------------------------


## --------- G --------- ##
    # --- True g
    splot(t, gt , type = "l", ylim = glim, labs = 0, lwd = 2)

    # --- Azadeh's g
    sadd(t, -ag, type = "l", col = skaturate$red, lwd = 2)

    # --- My g
    sadd(t, -sg, type = "l", col = skaturate$blue, lwd = 2)

    # Other lines
    abline(v = range(tb), col = skrown$B1, lty = 2)
    # abline(h = 0, col = skrown$B1, lty = 3)

    # Labels
    slab(
         "Normalized Estimates of g(t): Example B",
         bquote("Average over M ="~.(M)~"simulations;"~bold("B =")~bold(.(as.character(B))) ),
         "Time", "g(t)", yline = 2.5, mline = 2, cex.factor = 1.2)
    legend("topright",
       legend = c("g(t)",
                  bquote(hat(g)[1]*"(t)"),
                  bquote(hat(g)[2]*"(t)"),
                  "T(B) range"),
          col = c(skrown$B2, skaturate$red, skaturate$blue, skrown$B1),
          lwd = c(2,2,2,1), lty = c(1,1,1,2),
        inset = 0.01*c(1.5,2), y.intersp = 1.25, cex = 0.9)


## --------- Sy(f) --------- ##
    # --- True sy
    splot(Fs, normy(tru$yf), type = "l", ylim = flim, labs = 0, lwd = 2)

    # --- Azadeh's sy
    sadd(Fs, ayf, type = "l", col = skaturate$red, lwd = 2)

    # --- My sy
    sadd(Fs, syf, type = "l", col = skaturate$blue, lwd = 2)
    
    # Labels
    slab(
         bquote(bold("Normalized Estimates of"~S[Y]*"(f): Example B")),
         bquote("Average over M ="~.(M)~"simulations;"~bold("B =")~bold(.(as.character(B))) ), 
         "Frequency", bquote("Spectrum"~S[Y]*"(f)"), yline = 2.5, cex.factor = 1.2)
    legend("topright",
       legend = c(bquote(S[Y]*"(f)"),
                  bquote(hat(S)["Y, 1"]*"(f)"),
                  bquote(hat(S)["Y, 2"]*"(f)")),
          col = c(skrown$B2, skaturate$red, skaturate$blue),
          lwd = 2, inset = 0.01*c(1.5,2), y.intersp = 1.25, cex = 0.9)

# ---------------------------------------------------------------------------------
dev.off()
```







---


## UMP DEFUNCT

```{r setupSgram_z_DEFUNCT}
## --- Load 
load(file = "Data/UMP_B200_mini_rev.RData")
bc.x  <- bc
cbc.x <- cbc
tru.x <- tru

## --- Scaling & plot limits
# check
range(bc.x$mean);range(cbc.x$mean);range(tru.x$xtf)

bc.x$mean  <- bc.x$mean *1e2  # scale
cbc.x$mean <- cbc.x$mean*1e2

zlim.x <- range(tru.x$xtf, bc.x$mean, cbc.x$mean)
```

```{r Sgram_z}

png(filename = paste0("NewPlots/sgrams_UMP_B",B,"_rev_letterbox.png"),
    width = 12.6, height = 4.2, units = "in", res = 200, bg = skrown$salt, pointsize = 8)
## ----------------------------------------------------------------------------------

  # Margins
  par(mfrow = c(1,3), oma = c(0,3,0,5))
  
  # --- TRUE
  image(x = Fs, y = t, z = t(tru.x$xtf),
        xlab = "", ylab = "", zlim = zlim.x,
        las = 1, col = tim.colors()); sox()
  abline(h = range(tb), col = skrown$salt, lty = 2)
  slab("True TFS: UMP x(t)",
       "","Frequency","Time"); gc()
  
  # --- BC
  image(x = Fs, y = t, z = t(bc.x$mean),
        xlab = "", ylab = "", zlim = zlim.x,
        las = 1, col = tim.colors()); sox()
  abline(h = range(tb), col = skrown$salt, lty = 2)
  slab("BCMTFSE:  UMP x(t)",
       "","Frequency","Time"); gc()
  
  # --- CBC
  image(x = Fs, y = t, z = t(cbc.x$mean),
        xlab = "", ylab = "", zlim = zlim.x,
        las = 1, col = tim.colors()); sox()
  abline(h = range(tb), col = skrown$salt, lty = 2)
  slab("CBCMTFSE:  UMP x(t)",
       "","Frequency","Time"); gc()
  
  # --- Legend
  par(oma = c(0,0,0,3))
  image.plot(legend.only = TRUE,
             zlim = zlim.x, legend.shrink = 1, legend.width = 2)

## ----------------------------------------------------------------------------------
dev.off()

```

## GUMP

```{r setupSgram_z}
## --- Load 
load("Data/GUMP_B100_mini.RData")
bc.x  <- bc
cbc.x <- cbc
tru.x <- tru

## --- Scaling & plot limits
# check
range(bc.x$mean);range(cbc.x$mean);range(tru.x$xtf2)

bc.x$mean  <- bc.x$mean *1e2  # scale
cbc.x$mean <- cbc.x$mean*1e2

zlim.x <- range(tru.x$xtf2, bc.x$mean, cbc.x$mean)
```

```{r Sgram_z}

png(filename = paste0("NewPlots/sgrams_",my.type,"_B",B,".png"),
    width = 12.6, height = 4.2, units = "in", res = 200, bg = skrown$salt, pointsize = 8)
## ----------------------------------------------------------------------------------

  # Margins
  par(mfrow = c(1,3), oma = c(0,3,0,5))
  
  # --- TRUE
  image(x = Fs, y = t, z = t(tru.x$xtf2),
        xlab = "", ylab = "", zlim = zlim.x,
        las = 1, col = tim.colors()); sox()
  abline(h = range(tb), col = skrown$salt, lty = 2)
  slab("True TFS: GUMP x(t)",
       "","Frequency","Time"); gc()
  
  # --- BC
  image(x = Fs, y = t, z = t(bc.x$mean),
        xlab = "", ylab = "", zlim = zlim.x,
        las = 1, col = tim.colors()); sox()
  abline(h = range(tb), col = skrown$salt, lty = 2)
  slab("BCMTFSE:  GUMP x(t)",
       "","Frequency","Time"); gc()
  
  # --- CBC
  image(x = Fs, y = t, z = t(cbc.x$mean),
        xlab = "", ylab = "", zlim = zlim.x,
        las = 1, col = tim.colors()); sox()
  abline(h = range(tb), col = skrown$salt, lty = 2)
  slab("CBCMTFSE:  GUMP x(t)",
       "","Frequency","Time"); gc()
  
  # --- Legend
  par(oma = c(0,0,0,3))
  image.plot(legend.only = TRUE,
             zlim = zlim.x, legend.shrink = 1, legend.width = 2)

## ----------------------------------------------------------------------------------
dev.off()

```

# C estimators

```{r}
# what g(t) are you usng?
vers <- 1 + (gt[1] > gt[10])
rev <- if(vers > 1){"_rev"} else {""}
```

#### Plotting g(t) obtained from Mean [DEFUNCT]
## Plotting g(t) obtained from all sims

```{r}
# load("Data/gest_UMP_B200_mini.RData")
# load("Data/gest_UMP_B200_rev_mini.RData")
# load("Data/gest_UMP_B400_mini.RData")
# load("Data/gest_UMP_B400_rev_mini.RData")
```

#### Single Comparison

```{r}

png(filename = paste0("NewPlots/gest_",my.type,"_B",B,rev,".png"),
width = 12, height = 5, units = "in", res = 200, bg = skrown$salt, pointsize = 10)
# ----------------------------------------------------------------------------------------
    par(mfrow = c(1,2), mar = c(4,4,4.4,1))
    lim <- range(gt, g.bc, g.cbc)
    
    # --- BC
    splot(t, gt , type = "l", ylim = lim, labs = 0, lwd = 2)
    lines(g.bc$mean, col = skaturate$blue, lwd = 2)
    lines(g.bc$UCL , col = skastel$blue)
    lines(g.bc$LCL , col = skastel$blue)
    abline(v = range(tb), col = skrown$B1, lty = 2)
    slab(main = bquote("Estimation of"~hat(g)[.(vers)]~"(t) based on BC"),
         subb = bquote("Blockwidth B ="~.(B)),
         xlab = "Time", ylab = "g(t)")
    legend(if(vers>1){"top"}else{"topright"},
           legend = c("True g(t)", bquote(hat(g)~"mean ("*mu*") "), bquote(hat(g)~mu~"+/- 2se  ")),
           col = c(skrown$B2, skaturate$blue, skastel$blue),
           lwd = c(2,2,1), inset = 0.01, y.intersp = 1.25, cex = 0.9)
    
    # --- CBC
    splot(t, gt , type = "l", ylim = lim, labs = 0, lwd = 2)
    lines(g.cbc$mean, col = skol$orange, lwd = 2)
    lines(g.cbc$UCL , col = skaturate$yellow)
    lines(g.cbc$LCL , col = skaturate$yellow)
    abline(v = range(tb), col = skrown$B1, lty = 2)
    slab(main = bquote("Estimation of"~hat(g)[.(vers)]~"(t) based on CBC"),
         subb = bquote("Blockwidth B ="~.(B)),
         xlab = "Time", ylab = "g(t)")
    legend(if(vers>1){"top"}else{"topright"},
           legend = c("True g(t)", bquote(hat(g)~"mean ("*mu*") "), bquote(hat(g)~mu~"+/- 2se  ")),
           col = c(skrown$B2, skol$orange, skaturate$yellow),
           lwd = c(2,2,1), inset = 0.01, y.intersp = 1.25, cex = 0.9)
    
# ----------------------------------------------------------------------------------------
dev.off()
    
```

#### Multi-Comparison

```{r}

png(filename = paste0("NewPlots/gest_UMP_B200_B400.png"),
    width = 12, height = 16, units = "in", res = 200, bg = skrown$salt, pointsize = 12)
# png(filename = paste0("NewPlots/gest_UMP_B",B,".png"),
# width = 12, height = 16, units = "in", res = 200, bg = skrown$salt, pointsize = 10)

# ----------------------------------------------------------------------------------------
par(mfrow = c(3,2))
# par(mfrow = c(1,2))


# --------- B = 200 --------- #
load("Data/gest_UMP_B200_mini.RData")
lim <- range(gt, g.bc, g.cbc)

# --- BC
splot(t, gt , type = "l", ylim = lim, labs = 0, lwd = 2)
lines(g.bc$mean, col = skaturate$blue, lwd = 2)
lines(g.bc$UCL , col = skastel$blue)
lines(g.bc$LCL , col = skastel$blue)
abline(v = range(tb), col = skrown$B1, lty = 2)
slab(main = bquote("Estimation of"~hat(g)[.(vers)]~"(t) based on BC"),
     subb = bquote("Blockwidth B ="~.(B)),
     xlab = "Time", ylab = "g(t)")
legend(if(vers>1){"top"}else{"topright"},
       legend = c("True g(t)", bquote(hat(g)~"mean ("*mu*") "), bquote(hat(g)~mu~"+/- 2se  ")),
       col = c(skrown$B2, skaturate$blue, skastel$blue),
       lwd = c(2,2,1), inset = 0.02, y.intersp = 1.25, cex = 1.1)

# --- CBC
splot(t, gt , type = "l", ylim = lim, labs = 0, lwd = 2)
lines(g.cbc$mean, col = skol$orange, lwd = 2)
lines(g.cbc$UCL , col = skaturate$yellow)
lines(g.cbc$LCL , col = skaturate$yellow)
abline(v = range(tb), col = skrown$B1, lty = 2)
slab(main = bquote("Estimation of"~hat(g)[.(vers)]~"(t) based on CBC"),
     subb = bquote("Blockwidth B ="~.(B)),
     xlab = "Time", ylab = "g(t)")
legend(if(vers>1){"top"}else{"topright"},
       legend = c("True g(t)", bquote(hat(g)~"mean ("*mu*") "), bquote(hat(g)~mu~"+/- 2se  ")),
       col = c(skrown$B2, skol$orange, skaturate$yellow),
       lwd = c(2,2,1), inset = 0.02, y.intersp = 1.25, cex = 1.1)




# --------- B = 200 REV --------- # 
load("Data/gest_UMP_B200_rev_mini.RData")
lim <- range(gt, g.bc, g.cbc)

# --- BC
splot(t, gt , type = "l", ylim = lim, labs = 0, lwd = 2)
lines(g.bc$mean, col = skaturate$blue, lwd = 2)
lines(g.bc$UCL , col = skastel$blue)
lines(g.bc$LCL , col = skastel$blue)
abline(v = range(tb), col = skrown$B1, lty = 2)
slab(main = bquote("Estimation of"~hat(g)[2]~"(t) based on BC"),
     subb = bquote("Blockwidth B ="~.(B)),
     xlab = "Time", ylab = "g(t)")
legend(if(vers>1){"top"}else{"topright"},
       legend = c("True g(t)", bquote(hat(g)~"mean ("*mu*") "), bquote(hat(g)~mu~"+/- 2se  ")),
       col = c(skrown$B2, skaturate$blue, skastel$blue),
       lwd = c(2,2,1), inset = 0.02, y.intersp = 1.25, cex = 1.1)

# --- CBC
splot(t, gt , type = "l", ylim = lim, labs = 0, lwd = 2)
lines(g.cbc$mean, col = skol$orange, lwd = 2)
lines(g.cbc$UCL , col = skaturate$yellow)
lines(g.cbc$LCL , col = skaturate$yellow)
abline(v = range(tb), col = skrown$B1, lty = 2)
slab(main = bquote("Estimation of"~hat(g)[2]~"(t) based on CBC"),
     subb = bquote("Blockwidth B ="~.(B)),
     xlab = "Time", ylab = "g(t)")
legend(if(vers>1){"top"}else{"topright"},
       legend = c("True g(t)", bquote(hat(g)~"mean ("*mu*") "), bquote(hat(g)~mu~"+/- 2se  ")),
       col = c(skrown$B2, skol$orange, skaturate$yellow),
       lwd = c(2,2,1), inset = 0.02, y.intersp = 1.25, cex = 1.1)




# --------- B = 400 REV --------- #
load("Data/gest_UMP_B400_rev_mini.RData")
lim <- range(gt, g.bc, g.cbc)

# --- BC
splot(t, gt , type = "l", ylim = lim, labs = 0, lwd = 2)
lines(g.bc$mean, col = skaturate$blue, lwd = 2)
lines(g.bc$UCL , col = skastel$blue)
lines(g.bc$LCL , col = skastel$blue)
abline(v = range(tb), col = skrown$B1, lty = 2)
slab(main = bquote("Estimation of"~hat(g)[.(vers)]~"(t) based on BC"),
     subb = "Blockwidth B=400",
     xlab = "Time", ylab = "g(t)")
legend(if(vers>1){"top"}else{"topright"},
       legend = c("True g(t)", bquote(hat(g)~"mean ("*mu*") "), bquote(hat(g)~mu~"+/- 2se  ")),
       col = c(skrown$B2, skaturate$blue, skastel$blue),
       lwd = c(2,2,1), inset = 0.02, y.intersp = 1.25, cex = 1.1)

# --- CBC
splot(t, gt , type = "l", ylim = lim, labs = 0, lwd = 2)
lines(g.cbc$mean, col = skol$orange, lwd = 2)
lines(g.cbc$UCL , col = skaturate$yellow)
lines(g.cbc$LCL , col = skaturate$yellow)
abline(v = range(tb), col = skrown$B1, lty = 2)
slab(main = bquote("Estimation of"~hat(g)[.(vers)]~"(t) based on CBC"),
     subb = "Blockwidth B=400",
     xlab = "Time", ylab = "g(t)")
legend(if(vers>1){"top"}else{"topright"},
       legend = c("True g(t)", bquote(hat(g)~"mean ("*mu*") "), bquote(hat(g)~mu~"+/- 2se  ")),
       col = c(skrown$B2, skol$orange, skaturate$yellow),
       lwd = c(2,2,1), inset = 0.02, y.intersp = 1.25, cex = 1.1)
# ----------------------------------------------------------------------------------------
dev.off()
```



# Smoothed Spectrograms

## Not cheating

```{r}
# load("Data/gest_UMP_B200_mini.RData")
# load("Data/gest_UMP_B200_rev_mini.RData")
load("Data/gest_UMP_B400_rev_mini.RData")
```

```{r}
png(filename = paste0("NewPlots/smoothgrams_UMP_B",B,rev,"_letterbox.png"),
    width = 12.6, height = 4.2, units = "in", res = 200, bg = skrown$salt, pointsize = 8)
## ----------------------------------------------------------------------------------

par(mfrow = c(1,3), mar = c(9,4.4,4.4,1), oma = c(2.5,0,0,0))
# mat <- matrix(rep(1,16), ncol = 4)
# image(mat)

# TRUE
image(Fs, t, t(tru$xtf), zlim = range(tru$xtf),
      xlab = "", ylab = "", las = 1, col = tim.colors()); sox(); gc()
slab("True TFS: UMP", bquote("Modulating function g"[.(vers)]*"(t)"), "Frequency", "Time")
image.plot(legend.only = TRUE, legend.lab = "Power", zlim = range(tru$xtf),
           legend.line = -4, legend.cex = 0.9,
           horizontal  = TRUE, smallplot  = c(0.11,0.96,0,0.05))

image(Fs, t, bc.smooth , zlim = range( bc.smooth),
      xlab = "", ylab = "", las = 1, col = tim.colors()); sox(); gc()
abline(h = range(tb), col = skrown$salt, lty = 2)
slab("Smoothed BC", bquote("Modulating function g"[.(vers)]*"(t)"), "Frequency", "Time")
image.plot(legend.only = TRUE, legend.lab = "Power", zlim = range(bc.smooth),
           legend.line = -4, legend.cex = 0.9,
           horizontal  = TRUE, smallplot  = c(0.11,0.96,0,0.05))

image(Fs, t, cbc.smooth , zlim = range( cbc.smooth),
      xlab = "", ylab = "", las = 1, col = tim.colors()); sox(); gc()
abline(h = range(tb), col = skrown$salt, lty = 2)
slab("Smoothed CBC", bquote("Modulating function g"[.(vers)]*"(t)"), "Frequency", "Time")
image.plot(legend.only = TRUE, legend.lab = "Power", zlim = range(cbc.smooth),
           legend.line = -4, legend.cex = 0.9,
           horizontal  = TRUE, smallplot  = c(0.11,0.96,0,0.05))

## ----------------------------------------------------------------------------------
dev.off()
```


## Really not cheating

```{r}
# load("Data/gest_UMP_B200_full.RData")
# load("Data/gest_UMP_B200_rev_full.RData")
# load("Data/gest_UMP_B400_rev_full.RData")

# what g(t) are you usng?
vers <- 1 + (gt[1] > gt[10])
rev <- if(vers > 1){"_rev"} else {""}
```

```{r}
png(filename = paste0("NewPlots/smoothgrams_UMP_B",B,rev,"_single.png"),
    width = 12.6, height = 4.2, units = "in", res = 200, bg = skrown$salt, pointsize = 8)
## ----------------------------------------------------------------------------------

par(mfrow = c(1,3), mar = c(9,4.4,4.4,1), oma = c(2.5,0,0,0))
# mat <- matrix(rep(1,16), ncol = 4)
# image(mat)

# TRUE
image(Fs, t, t(tru$xtf), zlim = range(tru$xtf),
      xlab = "", ylab = "", las = 1, col = tim.colors()); sox(); gc()
slab("True TFS: UMP", bquote("Modulating function g"[.(vers)]*"(t)"), "Frequency", "Time")
image.plot(legend.only = TRUE, legend.lab = "Power", zlim = range(tru$xtf),
           legend.line = -4, legend.cex = 0.9,
           horizontal  = TRUE, smallplot  = c(0.11,0.96,0,0.05))

image(Fs, t, bc.smooth , zlim = range( bc.smooth),
      xlab = "", ylab = "", las = 1, col = tim.colors()); sox(); gc()
abline(h = range(tb), col = skrown$salt, lty = 2)
slab("Smoothed BC", bquote("Modulating function g"[.(vers)]*"(t)"), "Frequency", "Time")
image.plot(legend.only = TRUE, legend.lab = "Power", zlim = range(bc.smooth),
           legend.line = -4, legend.cex = 0.9,
           horizontal  = TRUE, smallplot  = c(0.11,0.96,0,0.05))

image(Fs, t, cbc.smooth , zlim = range( cbc.smooth),
      xlab = "", ylab = "", las = 1, col = tim.colors()); sox(); gc()
abline(h = range(tb), col = skrown$salt, lty = 2)
slab("Smoothed CBC", bquote("Modulating function g"[.(vers)]*"(t)"), "Frequency", "Time")
image.plot(legend.only = TRUE, legend.lab = "Power", zlim = range(cbc.smooth),
           legend.line = -4, legend.cex = 0.9,
           horizontal  = TRUE, smallplot  = c(0.11,0.96,0,0.05))

## ----------------------------------------------------------------------------------
dev.off()
```


## Single instance: no smooth

```{r}
png(filename = paste0("NewPlots/smoothgrams_UMP_B",B,rev,"_raw.png"),
    width = 12.6, height = 4.2, units = "in", res = 200, bg = skrown$salt, pointsize = 8)
## ----------------------------------------------------------------------------------

par(mfrow = c(1,3), mar = c(9,4.4,4.4,1), oma = c(2.5,0,0,0))
# mat <- matrix(rep(1,16), ncol = 4)
# image(mat)

# TRUE
image(Fs, t, t(tru$xtf), zlim = range(tru$xtf),
      xlab = "", ylab = "", las = 1, col = tim.colors()); sox(); gc()
slab("True TFS: UMP", bquote("Modulating function g"[.(vers)]*"(t)"), "Frequency", "Time")
image.plot(legend.only = TRUE, legend.lab = "Power", zlim = range(tru$xtf),
           legend.line = -4, legend.cex = 0.9,
           horizontal  = TRUE, smallplot  = c(0.11,0.96,0,0.05))

image(Fs, t, t(bc.samp) , zlim = range( bc.samp),
      xlab = "", ylab = "", las = 1, col = tim.colors()); sox(); gc()
abline(h = range(tb), col = skrown$salt, lty = 2)
slab("Smoothed BC", bquote("Modulating function g"[.(vers)]*"(t)"), "Frequency", "Time")
image.plot(legend.only = TRUE, legend.lab = "Power", zlim = range(bc.smooth),
           legend.line = -4, legend.cex = 0.9,
           horizontal  = TRUE, smallplot  = c(0.11,0.96,0,0.05))

image(Fs, t, t(cbc.samp) , zlim = range( cbc.samp),
      xlab = "", ylab = "", las = 1, col = tim.colors()); sox(); gc()
abline(h = range(tb), col = skrown$salt, lty = 2)
slab("Smoothed CBC", bquote("Modulating function g"[.(vers)]*"(t)"), "Frequency", "Time")
image.plot(legend.only = TRUE, legend.lab = "Power", zlim = range(cbc.smooth),
           legend.line = -4, legend.cex = 0.9,
           horizontal  = TRUE, smallplot  = c(0.11,0.96,0,0.05))

## ----------------------------------------------------------------------------------
dev.off()
```


# Spectrogram ColMeans for Stationary Series

```{r}
png(filename = paste0("NewPlots/smooth_yf_",my.type,"_B",B,".png"),
width = 12, height = 5, units = "in", res = 200, bg = skrown$salt, pointsize = 10)
# ----------------------------------------------------------------------------------------

    par(mfrow = c(1,2), mar = c(4,4,4.4,1))
    
    ## -------- M = 100 --------- ##
    
    # --- load
    load("Data/AR2_B200_full.RData")
    
    # --- Prep
    lim <- range(yf.mtm, yf.bc, yf.cbc, tru$yf/1e2)
    
    # --- Plot
    splot(Fs, tru$yf/1e2, ylim = lim, type = "l", lwd = 2, labs = 0, colr = skrown$salt)
    lines(Fs, yf.mtm, col = skastel$green)
    sadd (Fs, list(yf.bc$mean, yf.cbc$mean), type = "l", lwd = 2, col = list(skaturate$blue, skaturate$yellow))
    sadd (Fs, list(lcl.bc, lcl.cbc), type = "l", lwd = 1, col = list(skastel$blue, skastel$yellow))
    sadd (Fs, list(ucl.bc, ucl.cbc), type = "l", lwd = 1, col = list(skastel$blue, skastel$yellow))
    slab("Spectrum Estimates for Stationary AR(2) Series",
         "Mean over M=100 Simulations",
         "Frequency", bquote("Spectrum: "~S[Y]*"(f)"), yline = 2.5)
    legend("topright", legend = c("Theoretical", "Smooth BC", "Smooth CBC", "MTM"),
           lty = 1, lwd = 2, inset = 0.05,
           col = c(skrown$B2, skaturate$blue, skaturate$yellow, skastel$green))
    
    ## --------- M = 1 --------- ##
    
    # --- load
    load("Data/AR2_B200_samp.RData")
    
    # --- Prep
    lim <- range(yf.mtm, yf.bc, yf.cbc, tru$yf/1e2)
    
    # --- Plot
    splot(Fs, tru$yf/1e2, ylim = lim, type = "l", lwd = 2, labs = 0)
    lines(Fs, yf.mtm, col = skastel$green)
    sadd (Fs, list(yf.bc, yf.cbc), type = "l", lwd = 2, col = list(skaturate$blue, skaturate$yellow))
    slab("Spectrum Estimates for Stationary AR(2) Series",
         "All Estimates taken from a Single Simulation (M=1)",
         "Frequency", bquote("Spectrum: "~S[Y]*"(f)"), yline = 2.5)
    legend("topright", legend = c("Theoretical", "Smooth BC", "Smooth CBC", "MTM"), lty = 1, lwd = 2, inset = 0.05,
           col = c(skrown$B2, skaturate$blue, skaturate$yellow, skastel$green))
# ----------------------------------------------------------------------------------------
dev.off()
```









# Animations

## Frequency-Domain Animations

```{r}
## --- Choose your series
load("C:/Users/skyep/Documents/Research/PhD_Proposal/Data/")
```

```{r ani_prep}
## --- Plot Prep ---------------- ###

# Confidence Intervals (if it were Gaussian... isn't it more chi^2?)
bc.low   <-  bc$mean - 2* bc$se
bc.high  <-  bc$mean + 2* bc$se
cbc.low  <- cbc$mean - 2*cbc$se
cbc.high <- cbc$mean + 2*cbc$se

# ylims
ylim <- range(bc.low, cbc.low, bc.high, cbc.high)

# Spectrogram limit
zlim <- range(xtf.true/1e4, bc$mean, cbc$mean)
```

```{r f_domain_gif}

p <- 0
pb <- txtProgressBar(style = 3)

### --- Create GIF ------------------- ###

saveGIF({  for (my.t in seq(1,N,by = 5)) {
  
  # --- True Plot
  splot(Fs, ztf.true[my.t,]/1e4, type = "l", ylim = ylim.tx, lwd = 2, colr = "#FCF8F8"); gc()
  
  # --- Means
  lines(Fs,  bc$mean[my.t,], col = "dodgerblue2", lwd = 2) # OLD bc
  lines(Fs, cbc$mean[my.t,], col = "goldenrod"  , lwd = 2) # Cbc  
  
  # --- Standard Errors
  lines(Fs, bc.low [my.t,] , col = skol$blue  , lwd = 1)                     
  lines(Fs, bc.high[my.t,] , col = skol$blue  , lwd = 1)                     
  
  lines(Fs, cbc.low [my.t,], col = skol$orange, lwd = 1)                     
  lines(Fs, cbc.high[my.t,], col = skol$orange, lwd = 1)                     
  
  # --- Labels
  slab(main = "Spectrogram Estimates: UMP: c(t)*AR(2)",
       subb = bquote("c(t) = exp{ (-t-500)"^2*"/(2(200"^2*")) }        Blockwidth B ="~.(B)),
       xlab = "Frequency",
       ylab = bquote(hat(S)[X]~"(t = "*.(my.t)*", f)")); gc()
  
  
  ## --- Legends (& other graphics) --------------------------- ##
  legend("topright",
         legend = c("means","mean +/- 2se","",
                    "True spectrum at t",
                    "BCMTFSE",
                    "CBCMTFSE"),
         lty = c( 1, 1,NA,    1,NA,NA),
         lwd = c( 3, 1,NA,   NA,NA,NA),
         pch = c(NA,NA,NA,   19,19,19),
         
         col = c(skol$brown4, skol$brown4, skol$brown4,     skol$brown4,"dodgerblue2","goldenrod"),
         bg  = "white",
         inset = c(0.01,0.02)
    )
  legend("topleft", legend = bquote("Time t ="*.(my.t)*"  "),
         inset = c(0.05,0.08), cex = 2.5,
         bg = if((my.t >= tb[1]) & (my.t <= max(tb))) {skol$green} else {"#F4A4A8"})
  ## ---------------------------------------------------------- ##  
  
  gc()
    p <- p+1
    setTxtProgressBar(pb, p/500)

    } },
  
  # --- GIF details
  interval   = 0.1,
  movie.name = paste0("~/Plots/",my.type,"_B",B,".gif"),
  ani.height = 668, ani.width = 1080); gc()
```























































